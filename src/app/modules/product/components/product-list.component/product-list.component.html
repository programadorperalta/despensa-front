<div class="product-list-container">
  <div class="header">
    <h2>Lista de Productos</h2>
    <button (click)="nuevoProducto()" class="btn btn-primary">
      ‚ûï Nuevo Producto
    </button>
  </div>

  <!-- BUSCADOR Y FILTROS -->
  <div class="search-filters-section">
    <div class="search-container">
      <input type="text" class="search-input" placeholder="Buscar productos por nombre, c√≥digo o descripci√≥n..."
        [(ngModel)]="searchTerm" (input)="applyFilter()">
      <span class="search-icon">üîç</span>
    </div>

    <div class="filters-container">
      <select class="filter-select" [(ngModel)]="statusFilter" (change)="applyFilter()">
        <option value="">Todos los estados</option>
        <option value="active">Activos</option>
        <option value="inactive">Inactivos</option>
      </select>

      <select class="filter-select" [(ngModel)]="stockFilter" (change)="applyFilter()">
        <option value="">Todo el stock</option>
        <option value="low">Stock bajo (‚â§ 5)</option>
        <option value="out">Sin stock</option>
        <option value="available">Con stock</option>
      </select>
    </div>
  </div>

  <div class="table-container">
    <table class="products-table">
      <thead>
        <tr>
          <th>C√≥digo</th>
          <th>Nombre</th>
          <th>Descripci√≥n</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Estado</th>
          <th>C√≥digo Barras</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts" class="product-row">
          <td>{{ product.barraCode }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.description || 'Sin descripci√≥n' }}</td>
          <td>{{ formatearPrecio(product.price || 0) }}</td>
          <td>
            <span [class.low-stock]="product.stock || 0 <= 5" [class.out-of-stock]="product.stock === 0">
              {{ product.stock }}
            </span>
          </td>
          <td>{{ product.status ? 'Activo' : 'Inactivo' }}</td>
          <td class="barcode">
            <div class="barcode-container">
              <div [appBarcode]="product.barraCode || ''"></div>
              <button (click)="downloadBarcode(product.barraCode || '')" class="btn-download-barcode"
                title="Descargar c√≥digo de barras" *ngIf="product.barraCode">
                üì•
              </button>
            </div>
          </td>
          <td class="actions">
            <button (click)="editarProducto(product)" class="btn btn-edit">
              ‚úèÔ∏è Editar
            </button>
            <button (click)="eliminarProducto(product)" class="btn btn-delete">
              ‚¨áÔ∏è Desactivar
            </button>
            <button (click)="activateProduct(product)" class="btn btn-activate">
              ‚¨ÜÔ∏è Activar
            </button>
          </td>
        </tr>

        <tr *ngIf="filteredProducts.length === 0">
          <td colspan="8" class="no-products">
            <div class="no-products-content">
              <span class="no-products-icon">üì¶</span>
              <h3>No se encontraron productos</h3>
              <p *ngIf="products.length === 0">No hay productos registrados en el sistema.</p>
              <p *ngIf="products.length > 0">No hay productos que coincidan con tu b√∫squeda.</p>
              <button *ngIf="products.length === 0" (click)="nuevoProducto()" class="btn btn-primary">
                ‚ûï Crear primer producto
              </button>
              <button *ngIf="products.length > 0" (click)="clearFilters()" class="btn btn-secondary">
                üîÑ Limpiar filtros
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal para crear/editar productos -->
  <app-product-form-modal [isOpen]="showModal" [product]="selectedProduct" (closed)="onModalClosed()"
    (saved)="onProductSaved($event)">
  </app-product-form-modal>
</div>

<!-- Modal de Mensaje -->
<app-modal [isOpen]="openModal" [title]="title" [message]="mensaje" [isDelete]="isDelete" [isActivate]="isActivation"
  (confirmDelete)="confirmDelete()" (closed)="onModalClosed()" (confirmActivation)="confirmActivation()">
</app-modal>