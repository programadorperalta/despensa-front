<div class="venta-list-container">
  <!-- Header -->
  <div class="header">
    <h2>Historial de Ventas</h2>
    <button class="btn-primary" routerLink="/products">
      Nueva Venta
    </button>
  </div>

  <!-- EstadÃ­sticas -->
  <div class="stats-cards">
    <div class="stat-card">
      <div class="stat-label">Ventas Totales</div>
      <div class="stat-value">{{ getTotalVentas() | currency:'USD':'symbol':'1.2-2' }}</div>
      <div class="stat-trend positive">
        <!-- <span></span>
        <span>vs mes anterior</span> -->
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-label">Ventas del Mes</div>
      <div class="stat-value">{{ getVentasMes() | currency:'USD':'symbol':'1.2-2' }}</div>
      <!-- <div class="stat-trend positive">
        <span>â†‘ 8%</span>
        <span>vs mes anterior</span>
      </div> -->
    </div>

    <div class="stat-card">
      <div class="stat-label">Ventas Hoy</div>
      <div class="stat-value">{{ getVentasHoy() | currency:'USD':'symbol':'1.2-2' }}</div>
      <!-- <div class="stat-trend negative">
        <span>â†“ 5%</span>
        <span>vs ayer</span>
      </div> -->
    </div>

    <div class="stat-card">
      <div class="stat-label">Promedio por Venta</div>
      <div class="stat-value">{{ getPromedioVenta() | currency:'USD':'symbol':'1.2-2' }}</div>
      <!-- <div class="stat-trend positive">
        <span>â†‘ 3%</span>
        <span>vs mes anterior</span>
      </div> -->
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="fechaInicio">Fecha Inicio</label>
        <input type="date" id="fechaInicio" class="filter-input" [(ngModel)]="filtroFechaInicio"
          (change)="aplicarFiltros()">
      </div>

      <div class="filter-group">
        <label for="fechaFin">Fecha Fin</label>
        <input type="date" id="fechaFin" class="filter-input" [(ngModel)]="filtroFechaFin" (change)="aplicarFiltros()">
      </div>

      <div class="filter-group">
        <label for="metodoPago">MÃ©todo de Pago</label>
        <select id="metodoPago" class="filter-select" [(ngModel)]="filtroMetodoPago" (change)="aplicarFiltros()">
          <option value="">Todos</option>
          <option value="1">Efectivo</option>
          <option value="2">Transferencia</option>
          <option value="3">Tarjeta</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="montoMinimo">Monto MÃ­nimo</label>
        <input type="number" id="montoMinimo" class="filter-input" placeholder="0.00" [(ngModel)]="filtroMontoMinimo"
          (change)="aplicarFiltros()" min="0" step="0.01">
      </div>
    </div>
  </div>

  <!-- Tabla de Ventas -->
  <div class="table-container">
    <table class="ventas-table" *ngIf="ventas.length > 0; else noVentas">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha y Hora</th>
          <th>Total</th>
          <th>MÃ©todo de Pago</th>
          <th>Productos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let venta of ventasFiltradas" class="venta-row">
          <td>
            <strong>#{{ venta.id }}</strong>
          </td>
          <td>
            <div class="date-time">
              <span class="date">{{ venta.createdAt | date:'dd/MM/yyyy' }}</span>
              <span class="time">{{ venta.createdAt | date:'HH:mm' }}</span>
            </div>
          </td>
          <td>
            <span class="total-amount">{{ venta.total | currency:'USD':'symbol':'1.2-2' }}</span>
          </td>
          <td>
            <span class="payment-method {{ venta.metodoPago?.toLowerCase() }}">
              {{ this.determinarMetodoPago(venta.metodoPago) }}
            </span>
          </td>
          <td>
            <span class="products-count">
              {{ venta.products?.length || 0 }} productos
            </span>
            <div class="productos-list" *ngIf="venta.products && venta.products.length > 0">
              <small>
                {{ getNombresProductos(venta.products) }}
              </small>
            </div>
          </td>
          <td>
            <div class="actions">
              <button class="btn btn-view" (click)="verDetalle(venta)" title="Ver detalle">
                Ver
              </button>
              <button class="btn btn-receipt" (click)="generarRecibo(venta)" title="Generar recibo">
                Recibo
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Estado vacÃ­o -->
    <ng-template #noVentas>
      <div class="no-ventas">
        <div class="no-ventas-icon">ðŸ’¸</div>
        <h3>No hay ventas registradas</h3>
        <p>Comienza realizando tu primera venta</p>
        <button class="btn-primary" routerLink="/ventas/nueva" style="margin-top: 1rem;">
          Realizar Primera Venta
        </button>
      </div>
    </ng-template>
  </div>

  <!-- PaginaciÃ³n -->
  <div class="pagination" *ngIf="ventas.length > 0">
    <button class="page-btn" (click)="cambiarPagina(paginaActual - 1)" [disabled]="paginaActual === 1">â€¹
      Anterior</button>

    <span class="page-info">
      PÃ¡gina {{ paginaActual }} de {{ totalPaginas }}
    </span>

    <button class="page-btn" (click)="cambiarPagina(paginaActual + 1)"
      [disabled]="paginaActual === totalPaginas">Siguiente â€º</button>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="cargando">
    <div class="loading-spinner"></div>
    <span>Cargando ventas...</span>
  </div>
</div>

<app-modal [isOpen]="openModal" [title]="title" [message]="message" (closed)="closeModal()">
</app-modal>