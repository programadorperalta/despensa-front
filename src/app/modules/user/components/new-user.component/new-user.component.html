<div class="new-user-container" *ngIf="isVisible">
  <div class="header-section">
    <h2>{{ username ? 'Completar Registro' : 'Crear Nueva ContraseÃ±a' }}</h2>
    <p class="subtitle">
      {{ username ?
      'Complete su registro estableciendo una contraseÃ±a segura' :
      'Establezca una nueva contraseÃ±a para su cuenta'
      }}
    </p>
  </div>

  <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <!-- InformaciÃ³n del usuario (solo lectura) -->
    <div class="user-info" *ngIf="username">
      <div class="info-item">
        <span class="label">Usuario:</span>
        <span class="value">{{ username || username }}</span>
      </div>
    </div>

    <!-- Campo de nueva contraseÃ±a -->
    <div class="form-group">
      <label for="newPassword">Nueva contraseÃ±a *</label>
      <input [type]="showPassword ? 'text' : 'password'" id="newPassword" formControlName="newPassword"
        placeholder="Ingrese su nueva contraseÃ±a" [class.error]="isFieldInvalid('newPassword')">
      <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
        {{ showPassword ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
      </button>
      <div class="error-message" *ngIf="isFieldInvalid('newPassword')">
        <span *ngIf="userForm.get('newPassword')?.errors?.['required']">
          La contraseÃ±a es requerida
        </span>
        <span *ngIf="userForm.get('newPassword')?.errors?.['minlength']">
          MÃ­nimo 6 caracteres
        </span>
      </div>
    </div>

    <!-- Confirmar contraseÃ±a -->
    <div class="form-group">
      <label for="confirmPassword">Confirmar contraseÃ±a *</label>
      <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" formControlName="confirmPassword"
        placeholder="Confirme su contraseÃ±a"
        [class.error]="isFieldInvalid('confirmPassword') || userForm.hasError('passwordsMismatch')">
      <button type="button" class="toggle-password" (click)="toggleConfirmPasswordVisibility()">
        {{ showConfirmPassword ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸' }}
      </button>
      <div class="error-message" *ngIf="isFieldInvalid('confirmPassword')">
        <span *ngIf="userForm.get('confirmPassword')?.errors?.['required']">
          Debe confirmar la contraseÃ±a
        </span>
      </div>
      <div class="error-message"
        *ngIf="userForm.hasError('passwordsMismatch') && userForm.get('confirmPassword')?.touched">
        Las contraseÃ±as no coinciden
      </div>
    </div>

    <!-- Requisitos de contraseÃ±a -->
    <div class="password-requirements">
      <h4>La contraseÃ±a debe contener:</h4>
      <ul>
        <li [class.valid]="hasMinLength">â€¢ MÃ­nimo 6 caracteres</li>
        <li [class.valid]="hasUpperCase">â€¢ Al menos una mayÃºscula</li>
        <li [class.valid]="hasLowerCase">â€¢ Al menos una minÃºscula</li>
        <li [class.valid]="hasNumber">â€¢ Al menos un nÃºmero</li>
      </ul>
    </div>

    <!-- Mensajes de error general -->
    <div class="error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- BotÃ³n de envÃ­o -->
    <button type="submit" class="submit-btn" [disabled]="userForm.invalid || isLoading">
      <span class="loading-spinner" *ngIf="isLoading"></span>
      {{ isLoading ? 'Procesando...' : (username ? 'Completar Registro' : 'Crear ContraseÃ±a') }}
    </button>

    <!-- Enlace para cancelar -->
    <div class="cancel-section">
      <button type="button" class="cancel-btn" (click)="onCancel()">
        Cancelar
      </button>
    </div>
  </form>
</div>